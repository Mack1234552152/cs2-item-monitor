name: Corrected Price Notification

on:
  workflow_dispatch:

jobs:
  send-corrected-notification:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Corrected Price Notification
      run: |
        echo "Sending corrected notification with accurate CSQAQ prices..."
        
        # Get current IP
        CURRENT_IP=$(curl -s ifconfig.me)
        echo "Current IP: $CURRENT_IP"
        
        # Bind IP to CSQAQ API
        curl -X POST "https://api.csqaq.com/v1/ip/bind" \
          -H "Authorization: Bearer JOVN71P7T388E2N1G1H6W5A0" \
          -H "Content-Type: application/json" \
          -d "{\"ip\":\"$CURRENT_IP\"}" \
          --max-time 30 \
          --connect-timeout 10
        
        sleep 2
        
        # Send corrected notification with REAL CSQAQ prices
        curl -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "🔍 **价格修正通知**\n\n之前通知中的价格数据有误，以下是来自CSQAQ官网的准确价格：\n\n📊 **AK-47 | 红线 准确价格**：\n• 久经沙场: ¥196.5 (9950件在售)\n• 略有磨损: ¥1443 (1083件在售) \n• 战痕累累: ¥175 (69件在售)\n• 破损不堪: ¥159 (74件在售)\n\n📈 **热门饰品涨跌**：\n• AK-47 | 狩猎网格: ¥90 (+114.11%)\n• M4A4 | 活色生香: ¥1525 (+109.51%)\n• 运动手套 | 超导体: ¥16000 (+70.44%)\n\n📱 数据来源：CSQAQ.COM 官网实时数据\n⏰ 更新时间: 2025-10-25 21:14",
            "summary": "CSQAQ准确价格数据修正",
            "contentType": 3,
            "topicIds": [20648],
            "verifyPay": false
          }' \
          --max-time 30 \
          --connect-timeout 10
        
        echo "Corrected notification sent successfully!"