name: Test WXpusher Notification

on:
  workflow_dispatch:

jobs:
  test-wxpusher:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test WXpusher API
      run: |
        echo "ðŸ§ª æµ‹è¯•WXpusheré€šçŸ¥åŠŸèƒ½..."
        echo "AppToken: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj"
        
        # å‘é€æµ‹è¯•æ¶ˆæ¯åˆ°WXpusher
        response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj",
            "content": "ðŸŽ‰ CS2ä»·æ ¼ç›‘æŽ§ç³»ç»Ÿæµ‹è¯•é€šçŸ¥ï¼\n\nå¦‚æžœæ‚¨æ”¶åˆ°æ­¤æ¶ˆæ¯ï¼Œè¯´æ˜ŽWXpusheré€šçŸ¥é…ç½®æˆåŠŸï¼\næµ‹è¯•æ—¶é—´: '"$(date)"'",
            "summary": "CS2ç›‘æŽ§æµ‹è¯•é€šçŸ¥",
            "contentType": 3,
            "topicIds": [12345]
          }')
        
        echo "APIå“åº”: $response"
        
        # æ£€æŸ¥å“åº”çŠ¶æ€
        if echo "$response" | grep -q '"code":1000'; then
          echo "âœ… WXpusheré€šçŸ¥å‘é€æˆåŠŸï¼"
          echo "## ðŸŽ‰ é€šçŸ¥æµ‹è¯•ç»“æžœ" >> $GITHUB_STEP_SUMMARY
          echo "- **æµ‹è¯•æ—¶é—´**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **AppToken**: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj" >> $GITHUB_STEP_SUMMARY
          echo "- **çŠ¶æ€**: âœ… æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- **å“åº”**: $response" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ WXpusheré€šçŸ¥å‘é€å¤±è´¥ï¼"
          echo "## âŒ é€šçŸ¥æµ‹è¯•ç»“æžœ" >> $GITHUB_STEP_SUMMARY
          echo "- **æµ‹è¯•æ—¶é—´**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **AppToken**: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj" >> $GITHUB_STEP_SUMMARY
          echo "- **çŠ¶æ€**: âŒ å¤±è´¥" >> $GITHUB_STEP_SUMMARY
          echo "- **å“åº”**: $response" >> $GITHUB_STEP_SUMMARY
        fi