name: Test WXpusher Notification

on:
  workflow_dispatch:

jobs:
  test-wxpusher:
    runs-on: ubuntu-latest
    
    steps:
    - name: Test WXpusher API
      run: |
        echo "🧪 测试WXpusher通知功能..."
        echo "AppToken: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj"
        
        # 发送测试消息到WXpusher
        response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj",
            "content": "🎉 CS2价格监控系统测试通知！\n\n如果您收到此消息，说明WXpusher通知配置成功！\n测试时间: '"$(date)"'",
            "summary": "CS2监控测试通知",
            "contentType": 3,
            "topicIds": [12345]
          }')
        
        echo "API响应: $response"
        
        # 检查响应状态
        if echo "$response" | grep -q '"code":1000'; then
          echo "✅ WXpusher通知发送成功！"
          echo "## 🎉 通知测试结果" >> $GITHUB_STEP_SUMMARY
          echo "- **测试时间**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **AppToken**: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj" >> $GITHUB_STEP_SUMMARY
          echo "- **状态**: ✅ 成功" >> $GITHUB_STEP_SUMMARY
          echo "- **响应**: $response" >> $GITHUB_STEP_SUMMARY
        else
          echo "❌ WXpusher通知发送失败！"
          echo "## ❌ 通知测试结果" >> $GITHUB_STEP_SUMMARY
          echo "- **测试时间**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- **AppToken**: AT_MGRDCtFJyM0GSpNDL5Kx3veU7WVpc3nj" >> $GITHUB_STEP_SUMMARY
          echo "- **状态**: ❌ 失败" >> $GITHUB_STEP_SUMMARY
          echo "- **响应**: $response" >> $GITHUB_STEP_SUMMARY
        fi