name: Test WXpusher Notification

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-wxpusher:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Test Notification
      run: |
        echo "Testing WXpusher notification..."
        response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "ğŸ”§ æµ‹è¯•é€šçŸ¥ - '"$(date)"'\n\nâœ… å·¥ä½œæµè¿è¡ŒçŠ¶æ€: æ­£å¸¸\nğŸ“± æµ‹è¯•WXpusheræ¶ˆæ¯å‘é€\nğŸ¯ å¦‚æœæ”¶åˆ°æ­¤æ¶ˆæ¯ï¼Œè¯´æ˜é…ç½®æˆåŠŸ",
            "summary": "æµ‹è¯•é€šçŸ¥",
            "contentType": 1,
            "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
          }')
        echo "Response: $response"
        
        # æ£€æŸ¥å“åº”
        if echo "$response" | grep -q '"code":1000'; then
          echo "âœ… WXpusheré€šçŸ¥å‘é€æˆåŠŸ!"
        else
          echo "âŒ WXpusheré€šçŸ¥å‘é€å¤±è´¥:"
          echo "$response"
          exit 1
        fi