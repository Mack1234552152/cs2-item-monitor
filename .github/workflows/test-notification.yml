name: Test WXpusher Notification

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  test-wxpusher:
    runs-on: ubuntu-latest
    
    steps:
    - name: Send Test Notification
      run: |
        echo "Testing WXpusher notification..."
        response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "🔧 测试通知 - '"$(date)"'\n\n✅ 工作流运行状态: 正常\n📱 测试WXpusher消息发送\n🎯 如果收到此消息，说明配置成功",
            "summary": "测试通知",
            "contentType": 1,
            "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
          }')
        echo "Response: $response"
        
        # 检查响应
        if echo "$response" | grep -q '"code":1000'; then
          echo "✅ WXpusher通知发送成功!"
        else
          echo "❌ WXpusher通知发送失败:"
          echo "$response"
          exit 1
        fi