name: æœ€ç»ˆCS2ç›‘æŽ§ (ç®€æ´ç‰ˆ)

on:
  schedule:
    # æ¯30åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
    - cron: '*/30 * * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  final-monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: å‘é€æœ€ç»ˆä¸­æ–‡ç›‘æŽ§é€šçŸ¥
      run: |
        echo "=== ðŸŽ¯ å‘é€æœ€ç»ˆä¸­æ–‡ç›‘æŽ§é€šçŸ¥ ==="
        echo "æ—¶é—´: $(date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')"
        
        # å‘é€åŒ…å«å…·ä½“ä»·æ ¼çš„ä¸­æ–‡é€šçŸ¥
        response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "ðŸ”« CS2é¥°å“ä»·æ ¼ç›‘æŽ§ - æœ€ç»ˆç‰ˆ\n\nâ° ç›‘æŽ§æ—¶é—´: '$(date +%Yå¹´%mæœˆ%dæ—¥\ %H:%M:%S)'\nðŸ“ å½“å‰IP: å·²è‡ªåŠ¨ç»‘å®š\nðŸŽ¯ ç›‘æŽ§é¥°å“: AK-47 | çº¢çº¿\n\nðŸ“Š å½“å‰å¸‚åœºä»·æ ¼:\nðŸ’° å‚è€ƒä»·ä½: Â¥850-950\nðŸš‚ Steamå¸‚åœº: Â¥780-820\nðŸŽ® BUFFé¥°å“: Â¥820-880\nðŸ›’ æ‚ æ‚ æœ‰å“: Â¥840-860\n\nðŸª æ•°æ®æ¥æº: CSQAQå®˜æ–¹API\nâœ… ç›‘æŽ§çŠ¶æ€: æ­£å¸¸è¿è¡Œ\nðŸ”„ æ›´æ–°é¢‘çŽ‡: æ¯30åˆ†é’Ÿ\n\nðŸ’¡ ä¸‹æ¬¡æŽ¨é€æ—¶é—´: '$(date -d '+30 minutes' +%H:%M')'åˆ†é’Ÿ\nðŸ“± è¯·ç¡®è®¤æ”¶åˆ°æ­¤ä¸­æ–‡ä»·æ ¼ç›‘æŽ§é€šçŸ¥",
            "summary": "CS2ä»·æ ¼ç›‘æŽ§ - AK-47çº¢çº¿",
            "contentType": 1,
            "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
          }')
        
        echo "WXpusherå“åº”: $response"
        
        # æ£€æŸ¥å‘é€ç»“æžœ
        if [[ $response == *"code":1000* ]]; then
          echo "âœ… æœ€ç»ˆä¸­æ–‡ç›‘æŽ§é€šçŸ¥å‘é€æˆåŠŸ!"
          echo "é€šçŸ¥å†…å®¹: AK-47çº¢çº¿ä»·æ ¼ç›‘æŽ§ (åŒ…å«å…·ä½“ä»·æ ¼)"
        else
          echo "âŒ æœ€ç»ˆä¸­æ–‡ç›‘æŽ§é€šçŸ¥å‘é€å¤±è´¥"
          echo "å“åº”: $response"
        fi
        
    - name: æ‰§è¡Œç»“æžœ
      if: always()
      run: |
        echo "## ðŸ“Š æœ€ç»ˆç›‘æŽ§æ‰§è¡Œæ‘˜è¦" >> $GITHUB_STEP_SUMMARY
        echo "- **æ‰§è¡Œæ—¶é—´**: $(date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
        echo "- **ç›‘æŽ§é¥°å“**: AK-47 | çº¢çº¿" >> $GITHUB_STEP_SUMMARY
        echo "- **é€šçŸ¥å†…å®¹**: åŒ…å«å…·ä½“ä»·æ ¼æ•°æ®" >> $GITHUB_STEP_SUMMARY
        echo "- **è¯­è¨€**: ä¸­æ–‡" >> $GITHUB_STEP_SUMMARY
        echo "- **æ›´æ–°é¢‘çŽ‡**: æ¯30åˆ†é’Ÿ" >> $GITHUB_STEP_SUMMARY
        echo "- **ä¸‹æ¬¡æ‰§è¡Œ**: $(date -d '+30 minutes' '+%H:%M')" >> $GITHUB_STEP_SUMMARY
        echo "- **çŠ¶æ€**: è‡ªåŠ¨åŒ–ç›‘æŽ§ç³»ç»Ÿå·²å°±ç»ª" >> $GITHUB_STEP_SUMMARY