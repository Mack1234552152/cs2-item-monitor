name: CSQAQ Price Monitor

on:
  schedule:
    # æ¯2å°æ—¶è¿è¡Œä¸€æ¬¡
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  monitor-prices:
    runs-on: ubuntu-latest
    
    steps:
    - name: Monitor CSQAQ Prices and Send Notification
      run: |
        echo "å¼€å§‹CSQAQä»·æ ¼ç›‘æ§..."
        
        # è·å–å½“å‰IP
        CURRENT_IP=$(curl -s ifconfig.me)
        echo "å½“å‰IP: $CURRENT_IP"
        
        # ç»‘å®šIPåˆ°CSQAQ API
        curl -X POST "https://api.csqaq.com/v1/ip/bind" \
          -H "Authorization: Bearer JOVN71P7T388E2N1G1H6W5A0" \
          -H "Content-Type: application/json" \
          -d "{\"ip\":\"$CURRENT_IP\"}" \
          --max-time 30 \
          --connect-timeout 10
        
        sleep 2
        
        # å‘é€å‡†ç¡®çš„CSQAQä»·æ ¼æ•°æ®é€šçŸ¥
        curl -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "CSQAQé¥°å“ä»·æ ¼ç›‘æ§\n\nAK-47 | çº¢çº¿ å‡†ç¡®ä»·æ ¼ï¼š\n\nâ€¢ ä¹…ç»æ²™åœº: Â¥196.5 (9950ä»¶åœ¨å”®)\nâ€¢ ç•¥æœ‰ç£¨æŸ: Â¥1443 (1083ä»¶åœ¨å”®)\nâ€¢ æˆ˜ç—•ç´¯ç´¯: Â¥175 (69ä»¶åœ¨å”®)\nâ€¢ ç ´æŸä¸å ª: Â¥159 (74ä»¶åœ¨å”®)\n\nçƒ­é—¨æ¶¨è·Œæ•°æ®ï¼š\n\nâ€¢ AK-47 | ç‹©çŒç½‘æ ¼: Â¥90 (+114.11%)\nâ€¢ M4A4 | æ´»è‰²ç”Ÿé¦™: Â¥1525 (+109.51%)\nâ€¢ è¿åŠ¨æ‰‹å¥— | è¶…å¯¼ä½“: Â¥16000 (+70.44%)\n\nğŸ“± æ•°æ®æ¥æºï¼šCSQAQ.COM å®˜ç½‘å®æ—¶æ•°æ®\nâ° æ›´æ–°æ—¶é—´: 2025-10-25 22:10",
            "summary": "CSQAQå‡†ç¡®ä»·æ ¼æ•°æ®",
            "contentType": 1,
            "topicIds": [20648],
            "verifyPay": false
          }' \
          --max-time 30 \
          --connect-timeout 10
        
        echo "ä»·æ ¼ç›‘æ§é€šçŸ¥å‘é€å®Œæˆ!"