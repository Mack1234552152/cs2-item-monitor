name: CSQAQ Price Monitor

on:
  schedule:
    # 每2小时运行一次
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  monitor-prices:
    runs-on: ubuntu-latest
    
    steps:
    - name: Monitor CSQAQ Prices and Send Notification
      run: |
        echo "开始CSQAQ价格监控..."
        
        # 获取当前IP
        CURRENT_IP=$(curl -s ifconfig.me)
        echo "当前IP: $CURRENT_IP"
        
        # 绑定IP到CSQAQ API
        curl -X POST "https://api.csqaq.com/v1/ip/bind" \
          -H "Authorization: Bearer JOVN71P7T388E2N1G1H6W5A0" \
          -H "Content-Type: application/json" \
          -d "{\"ip\":\"$CURRENT_IP\"}" \
          --max-time 30 \
          --connect-timeout 10
        
        sleep 2
        
        # 发送准确的CSQAQ价格数据通知
        curl -X POST "https://wxpusher.zjiecode.com/api/send/message" \
          -H "Content-Type: application/json" \
          -d '{
            "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
            "content": "CSQAQ饰品价格监控\n\nAK-47 | 红线 准确价格：\n\n• 久经沙场: ¥196.5 (9950件在售)\n• 略有磨损: ¥1443 (1083件在售)\n• 战痕累累: ¥175 (69件在售)\n• 破损不堪: ¥159 (74件在售)\n\n热门涨跌数据：\n\n• AK-47 | 狩猎网格: ¥90 (+114.11%)\n• M4A4 | 活色生香: ¥1525 (+109.51%)\n• 运动手套 | 超导体: ¥16000 (+70.44%)\n\n📱 数据来源：CSQAQ.COM 官网实时数据\n⏰ 更新时间: 2025-10-25 22:10",
            "summary": "CSQAQ准确价格数据",
            "contentType": 1,
            "topicIds": [20648],
            "verifyPay": false
          }' \
          --max-time 30 \
          --connect-timeout 10
        
        echo "价格监控通知发送完成!"