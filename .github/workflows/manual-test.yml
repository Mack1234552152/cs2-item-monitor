name: Manual Test Notification

on:
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Type of test to run'
        required: true
        default: 'simple'
        type: choice
        options:
        - simple
        - chinese
        - english

jobs:
  send-test:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
    - name: Get current IP
      id: ip
      run: |
        IP=$(curl -s https://ipinfo.io/ip)
        echo "current_ip=$IP" >> $GITHUB_OUTPUT
        
    - name: Send test notification
      run: |
        echo "=== ğŸ§ª Sending Test Notification ==="
        echo "Test Type: ${{ github.event.inputs.test_type || 'simple' }}"
        echo "Time: $(date)"
        echo "IP: ${{ steps.ip.outputs.current_ip }}"
        
        if [[ "${{ github.event.inputs.test_type }}" == "chinese" ]]; then
          # Chinese notification
          response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
            -H "Content-Type: application/json" \
            -d '{
              "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
              "content": "ğŸ”§ æ‰‹åŠ¨æµ‹è¯•é€šçŸ¥\n\nâ° æµ‹è¯•æ—¶é—´: '"$(date '+%Y-%m-%d %H:%M:%S')"'"\nğŸ“ å½“å‰IP: ${{ steps.ip.outputs.current_ip }}\nğŸ¯ æµ‹è¯•ç±»å‹: ä¸­æ–‡é€šçŸ¥\nâœ… è¿™æ˜¯ä¸€ä¸ªæ‰‹åŠ¨æµ‹è¯•é€šçŸ¥ï¼Œç”¨äºéªŒè¯ç³»ç»ŸçŠ¶æ€",
              "summary": "æ‰‹åŠ¨æµ‹è¯• - ä¸­æ–‡é€šçŸ¥",
              "contentType": 1,
              "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
            }')
        elif [[ "${{ github.event.inputs.test_type }}" == "english" ]]; then
          # English notification
          response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
            -H "Content-Type: application/json" \
            -d '{
              "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
              "content": "ğŸ”§ Manual Test Notification\n\nâ° Test Time: '"$(date '+%Y-%m-%d %H:%M:%S')"'"\nğŸ“ Current IP: ${{ steps.ip.outputs.current_ip }}\nğŸ¯ Test Type: English Notification\nâœ… This is a manual test notification to verify system status",
              "summary": "Manual Test - English",
              "contentType": 1,
              "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
            }')
        else
          # Simple default notification
          response=$(curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
            -H "Content-Type: application/json" \
            -d '{
              "appToken": "AT_oVgZnjiSqzzv1ycEbihcgjtoM4BggMjz",
              "content": "æµ‹è¯•é€šçŸ¥\n\næ—¶é—´: '"$(date '+%Y-%m-%d %H:%M:%S')"'"\nIP: ${{ steps.ip.outputs.current_ip }}\nçŠ¶æ€: æ­£å¸¸",
              "summary": "æµ‹è¯•é€šçŸ¥",
              "contentType": 1,
              "uids": ["UID_Nkv98Q7XEQcDsvSInIlR10nm33xI"]
            }')
        fi
        
        echo "WXpusher Response: $response"
        
        # Check result
        if [[ $response == *"code":1000* ]]; then
          echo "âœ… Test notification sent successfully!"
          echo "Result: SUCCESS"
        else
          echo "âŒ Test notification failed"
          echo "Response: $response"
          echo "Result: FAILED"
        fi